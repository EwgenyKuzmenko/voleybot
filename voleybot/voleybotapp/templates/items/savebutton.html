<table style="width:100%">
    <tr>
        <td colspan="2">
            <button id="save_button" disabled onclick="save_button_click(this)">{{local.6}}</button>
        </td>
        <td style="text-align: right">
            <button id="delete_button" disabled onclick="delete_button_click(this)">{{local.1}}</button>
        </td>
    </tr>
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    function item_select(obj) {

        if (obj.value == "new_item") {
            
            document.getElementById("item_name").value = '';
            document.getElementById("item_description").value = '';
            document.getElementById("item_price").value = '';
            document.getElementById("item_photo").value = '';
            document.getElementById("item_image").src = '#';
            document.getElementById("item_group").value = '';
            document.getElementById("item_qrcode").src = '#';
            document.getElementById("item_active").checked = false;
            check_save_button();
            check_delete_button();
        
        } else {

            url_string = window.location.origin + "/get_obj/Item/" + obj.value;
            $.getJSON(url_string, function(data, jqXHR){

                url_string = window.location.origin + "/get_obj/Group/" + data[0].fields.group;
                $.getJSON(url_string, function(data, jqXHR){ 
                    document.getElementById("item_group").value = data[0].fields.name;
                });

                url_string = window.location.origin + "/get_obj/QRCode/" + data[0].fields.qrcode_id;
                $.getJSON(url_string, function(data, jqXHR){
                    document.getElementById("item_qrcode").src = data[0].fields.image_path;
                });

                document.getElementById("item_name").value = data[0].fields.name;
                document.getElementById("item_description").value = data[0].fields.description;
                document.getElementById("item_price").value = data[0].fields.price;
                document.getElementById("item_image").src = data[0].fields.image_path;
                document.getElementById("item_active").checked = data[0].fields.is_active;
            });

            check_save_button();
            check_delete_button();
        }
    }

    function activeHandler(string) {
        if (string == "on") {
            return "True";
        } else {
            return "False";
        }
    }
    
    function check_save_button() {
        if (document.getElementById("item_name").value != "" && document.getElementById("item_price").value != "") {
            document.getElementById("save_button").disabled = false;
        } else {
            document.getElementById("save_button").disabled = true;
        }
    }

    function check_delete_button() {
        if (document.getElementById("items_id").value != "new_item") {
            document.getElementById("delete_button").disabled = false;
        } else {
            document.getElementById("delete_button").disabled = true;
        }
    }

    function save_button_click(button) {
        if (document.getElementById("items_id").value == "new_item")
        {
            var new_item_data = {
                "name": document.getElementById("item_name").value,
                "description": document.getElementById("item_description").value,
                "price": document.getElementById("item_price").value,
                "is_active": activeHandler(document.getElementById("item_active").value),
                "group_id": document.getElementById("item_group").value,
                //"image_path": document.getElementById("item_image").src
            };

            const http = new XMLHttpRequest();
            http.open("GET", window.location.origin + "/new_item/" + JSON.stringify(new_item_data) + "/" + JSON.stringify(document.getElementById("item_image").src));
            http.send();
        }
    }

    function delete_button_click(button) {
        alert(" ");
    }
</script>